---
title: survival
date: '2023-12-29'
categories: [statistics]
---

WIP 

working on data from: https://www.frontiersin.org/articles/10.3389/fvets.2020.00388/full

learning survival analysis. they use SPSS "Life Table Analysis", which from the tutorials I watched was just survival analysis.

the treatment was if neutered/intact, and they ran the analysis for each neutered category (I think).

status is if there was a complication or not. and I am not sure what time is. time is not a specific column in the available data, unfortunately.

```r

install.packages("pammtools")
install.packages("readxl")

library(tidyverse)
library(tidybayes)
library(cmdstanr)
library(survival)
library(readxl)

library(lubridate)


d <- read_excel('data_Golden Retriever.xlsx')

# LSA, HSA, MCT, OSA
veteran

q <- d |> 
    mutate(
        HSA = as.Date(as.integer(HSA), origin = "1899-12-30"),
        LSA = as.Date(as.integer(LSA), origin = "1899-12-30"),
        MCT = as.Date(as.integer(MCT), origin = "1899-12-30"),
        OSA = as.Date(as.integer(OSA), origin = "1899-12-30"),
        )

# q$DOB <- ymd(str_replace(q$DOB, "UTC", ""))

q <- q |> 
    mutate(
        time_end = NEND - DOB 
    )

# q$time_end      
# q$time_event <- apply(select(q, c(LSA, HSA, MCT, OSA)), 1, FUN = min, na.rm = TRUE)
# q$DOB
# # ifelse(!is.na(q$time_event), q$time_event, q$time_end)


my_blue <- rgb(45/250, 62/250, 80/250, 1)

my_theme<- theme_classic() %+replace% 
           theme(panel.grid.major = element_line(),
                 aspect.ratio = 1/1.61)

vet_km <- survfit(Surv(time, status) ~ strata(trt), data=veteran)

bkm <- broom::tidy(vet_km) %>% 
       mutate(strata = str_remove(strata, 'strata\\(trt\\)=trt=')) %>% 
       rename(trt=strata)


base_plot <- bkm %>% 
              ggplot(aes(time, 1-estimate, ymax=1-conf.low, ymin=1-conf.high, color=trt, fill=trt)) + 
              geom_step() + 
              pammtools::geom_stepribbon(alpha=0.5, size=0) 



base_plot <- bkm %>% 
              ggplot(aes(time, estimate, ymax=conf.low, ymin=conf.high, color=trt, fill=trt)) + 
              geom_step() + 
              pammtools::geom_stepribbon(alpha=0.5, size=0) 



base_plot +
  my_theme + 
  labs(x='Time', y=expression(1-S(t))) +
  scale_fill_brewer(palette = 'Set1') +
  scale_color_brewer(palette = 'Set1') +
  coord_cartesian(xlim=c(0, 250)) + 
  scale_y_continuous(labels = scales::percent)


# time & status given treatment

# treatment is not binary
# treatment is whether they were neutered or not

# time should be the age of the dog
# either at 

# status is a complication or not


```


